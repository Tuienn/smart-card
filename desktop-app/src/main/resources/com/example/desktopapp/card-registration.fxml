<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.shape.*?>
<?import javafx.geometry.*?>

<BorderPane xmlns="http://javafx.com/javafx/17" 
            xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="com.example.desktopapp.controller.CardRegistrationController"
            styleClass="root">
    
    <!-- Header with Progress Steps -->
    <top>
        <VBox alignment="CENTER" spacing="20" style="-fx-padding: 30 40 20 40;">
            <HBox alignment="CENTER" spacing="10" fx:id="stepIndicator">
                <!-- Step 1 -->
                <Label text="1" styleClass="step-indicator, step-active" fx:id="step1Label"/>
                <Label text="â†’" fx:id="arrow1" styleClass="step-arrow" style="-fx-font-size: 32px; -fx-font-weight: bold;"/>
                
                <!-- Step 2 -->
                <Label text="2" styleClass="step-indicator, step-inactive" fx:id="step2Label"/>
                <Label text="â†’" fx:id="arrow2" styleClass="step-arrow" style="-fx-font-size: 32px; -fx-font-weight: bold;"/>
                
                <!-- Step 3 -->
                <Label text="3" styleClass="step-indicator, step-inactive" fx:id="step3Label"/>
                <Label text="â†’" fx:id="arrow3" styleClass="step-arrow" style="-fx-font-size: 32px; -fx-font-weight: bold;"/>
                
                <!-- Step 4 -->
                <Label text="4" styleClass="step-indicator, step-inactive" fx:id="step4Label"/>
            </HBox>
            
            <Label fx:id="stepTitle" text="ÄÄƒng KÃ½ ThÃ´ng Tin" styleClass="title-medium"/>
        </VBox>
    </top>
    
    <!-- Main Content Area with Scroll -->
    <center>
        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" vbarPolicy="AS_NEEDED" 
                    styleClass="scroll-pane" style="-fx-background: transparent; -fx-background-color: transparent;">
            <StackPane fx:id="contentStack" style="-fx-padding: 0 60 0 60;">
                
                <!-- STEP 1: User Registration Form -->
                <VBox fx:id="step1Content" alignment="CENTER" spacing="30" visible="true">
                    <VBox styleClass="card-container" spacing="25" maxWidth="700">
                        
                        <!-- Avatar Upload -->
                        <HBox alignment="CENTER">
                            <StackPane fx:id="avatarContainer" styleClass="avatar-placeholder" 
                                       onMouseClicked="#onAvatarClick">
                                <ImageView fx:id="avatarImage" fitWidth="110" fitHeight="110" preserveRatio="true">
                                    <clip>
                                        <Circle radius="55" centerX="55" centerY="55"/>
                                    </clip>
                                </ImageView>
                                <Label fx:id="avatarPlaceholderText" text="ðŸ“·" style="-fx-font-size: 36px;" 
                                       visible="true"/>
                            </StackPane>
                        </HBox>
                        <Label text="Nháº¥n Ä‘á»ƒ chá»n áº£nh Ä‘áº¡i diá»‡n" styleClass="text-secondary" 
                               style="-fx-font-size: 14px;"/>
                        
                        <!-- Name Field -->
                        <VBox spacing="8">
                            <Label text="Há» vÃ  TÃªn" styleClass="form-label"/>
                            <TextField fx:id="nameField" promptText="Nháº­p há» tÃªn cá»§a báº¡n" 
                                       styleClass="text-field"/>
                        </VBox>
                        
                        <!-- Phone Field -->
                        <VBox spacing="8">
                            <Label text="Sá»‘ Äiá»‡n Thoáº¡i" styleClass="form-label"/>
                            <TextField fx:id="phoneField" promptText="Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i" 
                                       styleClass="text-field"/>
                        </VBox>
                        
                        <!-- Gender Selection -->
                        <VBox spacing="8">
                            <Label text="Giá»›i TÃ­nh" styleClass="form-label"/>
                            <HBox styleClass="gender-toggle" spacing="0">
                                <ToggleButton fx:id="maleBtn" text="ðŸ‘¨ Nam" 
                                              onAction="#onGenderSelect" userData="1"/>
                                <ToggleButton fx:id="femaleBtn" text="ðŸ‘© Ná»¯" 
                                              onAction="#onGenderSelect" userData="2"/>
                            </HBox>
                        </VBox>
                        
                        <!-- PIN Field -->
                        <VBox spacing="8">
                            <Label text="MÃ£ PIN (4-6 sá»‘)" styleClass="form-label"/>
                            <PasswordField fx:id="pinField" promptText="Nháº­p mÃ£ PIN" 
                                           styleClass="password-field"/>
                        </VBox>
                        
                        <!-- Confirm PIN Field -->
                        <VBox spacing="8">
                            <Label text="XÃ¡c Nháº­n PIN" styleClass="form-label"/>
                            <PasswordField fx:id="confirmPinField" promptText="Nháº­p láº¡i mÃ£ PIN" 
                                           styleClass="password-field"/>
                        </VBox>
                    </VBox>
                </VBox>
                
                <!-- STEP 2: Payment Amount -->
                <VBox fx:id="step2Content" alignment="CENTER" spacing="30" visible="false">
                    <VBox styleClass="card-container" spacing="30" maxWidth="700">
                        
                        <Label text="ðŸ’° Chá»n Sá»‘ Tiá»n Náº¡p" styleClass="title-small"/>
                        
                        <!-- Amount Buttons Grid -->
                        <GridPane hgap="20" vgap="20" alignment="CENTER">
                            <Button text="100,000Ä‘" styleClass="btn, amount-btn" 
                                    onAction="#onAmountSelect" userData="100000"
                                    GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                            <Button text="200,000Ä‘" styleClass="btn, amount-btn" 
                                    onAction="#onAmountSelect" userData="200000"
                                    GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                            <Button text="300,000Ä‘" styleClass="btn, amount-btn" 
                                    onAction="#onAmountSelect" userData="300000"
                                    GridPane.columnIndex="2" GridPane.rowIndex="0"/>
                            <Button text="500,000Ä‘" styleClass="btn, amount-btn" 
                                    onAction="#onAmountSelect" userData="500000"
                                    GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                            <Button text="1,000,000Ä‘" styleClass="btn, amount-btn" 
                                    onAction="#onAmountSelect" userData="1000000"
                                    GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                            <Button text="KhÃ¡c" styleClass="btn, amount-btn" 
                                    onAction="#onCustomAmount"
                                    GridPane.columnIndex="2" GridPane.rowIndex="1"/>
                        </GridPane>
                        
                        <!-- Custom Amount Input -->
                        <VBox fx:id="customAmountBox" spacing="8" visible="false" managed="false">
                            <Label text="Nháº­p sá»‘ tiá»n (VNÄ)" styleClass="form-label"/>
                            <TextField fx:id="customAmountField" promptText="VÃ­ dá»¥: 150000" 
                                       styleClass="text-field"/>
                        </VBox>
                        
                        <!-- Coin Display -->
                        <VBox styleClass="coin-display" alignment="CENTER" spacing="10">
                            <Label text="Báº¡n sáº½ nháº­n Ä‘Æ°á»£c" styleClass="text-secondary"/>
                            <HBox alignment="CENTER" spacing="15">
                                <Label fx:id="coinDisplay" text="0" styleClass="coin-amount"/>
                                <Label text="ðŸª™ COINS" style="-fx-font-size: 24px; -fx-text-fill: #fbbf24;"/>
                            </HBox>
                            <Label text="(10,000Ä‘ = 1 Coin)" styleClass="text-secondary" style="-fx-font-size: 14px;"/>
                        </VBox>
                        
                        <!-- Selected Amount Display -->
                        <Label fx:id="selectedAmountLabel" text="" styleClass="text-secondary" 
                               style="-fx-font-size: 18px;"/>
                    </VBox>
                </VBox>
                
                <!-- STEP 3: Card Writing -->
                <VBox fx:id="step3Content" alignment="CENTER" spacing="30" visible="false">
                    <VBox styleClass="card-container" spacing="30" maxWidth="600" alignment="CENTER">
                        
                        <Label text="ðŸ’³ Ghi Dá»¯ Liá»‡u VÃ o Tháº»" styleClass="title-small"/>
                        
                        <!-- Card Animation Area -->
                        <StackPane style="-fx-min-height: 200;">
                            <!-- Waiting state -->
                            <VBox fx:id="cardWaitingState" alignment="CENTER" spacing="20">
                                <Label text="ðŸ“²" style="-fx-font-size: 80px;"/>
                                <Label text="Äáº·t tháº» lÃªn Ä‘áº§u Ä‘á»c" styleClass="subtitle"/>
                                <Label text="Äáº£m báº£o tháº» Ä‘Æ°á»£c Ä‘áº·t Ä‘Ãºng vá»‹ trÃ­" styleClass="text-secondary"/>
                            </VBox>
                            
                            <!-- Writing state -->
                            <VBox fx:id="cardWritingState" alignment="CENTER" spacing="20" visible="false">
                                <ProgressIndicator fx:id="writeProgress" styleClass="loading-spinner" 
                                                   style="-fx-min-width: 80; -fx-min-height: 80;"/>
                                <Label fx:id="writeStatusLabel" text="Äang ghi dá»¯ liá»‡u..." styleClass="subtitle"/>
                            </VBox>
                            
                            <!-- Success state -->
                            <VBox fx:id="cardSuccessState" alignment="CENTER" spacing="20" visible="false">
                                <Label text="âœ…" style="-fx-font-size: 80px;"/>
                                <Label text="Ghi tháº» thÃ nh cÃ´ng!" styleClass="subtitle" style="-fx-text-fill: #22c55e;"/>
                            </VBox>
                            
                            <!-- Error state -->
                            <VBox fx:id="cardErrorState" alignment="CENTER" spacing="20" visible="false">
                                <Label text="âŒ" style="-fx-font-size: 80px;"/>
                                <Label fx:id="errorMessageLabel" text="CÃ³ lá»—i xáº£y ra" styleClass="subtitle" 
                                       style="-fx-text-fill: #ef4444;"/>
                            </VBox>
                        </StackPane>
                        
                        <!-- Write Card Button -->
                        <Button fx:id="writeCardBtn" text="ðŸ” Báº®T Äáº¦U GHI THáºº" 
                                styleClass="btn, btn-primary, btn-large" onAction="#onWriteCard"/>
                    </VBox>
                </VBox>
                
                <!-- STEP 4: Success -->
                <VBox fx:id="step4Content" alignment="CENTER" spacing="30" visible="false">
                    <VBox styleClass="success-card" spacing="30" maxWidth="600" alignment="CENTER">
                        
                        <Label text="ðŸŽ‰" style="-fx-font-size: 80px;"/>
                        <Label text="ÄÄ‚NG KÃ THÃ€NH CÃ”NG!" styleClass="title-medium" style="-fx-text-fill: #22c55e;"/>
                        
                        <!-- User Summary -->
                        <VBox styleClass="glass-panel" spacing="15" alignment="CENTER_LEFT">
                            <HBox spacing="10">
                                <Label text="ðŸ‘¤ TÃªn:" styleClass="text-secondary"/>
                                <Label fx:id="summaryName" text="" styleClass="text-primary"/>
                            </HBox>
                            <HBox spacing="10">
                                <Label text="ðŸ“± SÄT:" styleClass="text-secondary"/>
                                <Label fx:id="summaryPhone" text="" styleClass="text-primary"/>
                            </HBox>
                            <HBox spacing="10">
                                <Label text="ðŸª™ Coins:" styleClass="text-secondary"/>
                                <Label fx:id="summaryCoins" text="" styleClass="text-accent"/>
                            </HBox>
                        </VBox>
                        
                        <Label text="Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng tháº» nÃ y táº¡i cÃ¡c mÃ¡y game trong khu vui chÆ¡i" 
                               styleClass="text-secondary" wrapText="true" textAlignment="CENTER"/>
                    </VBox>
                </VBox>
                
            </StackPane>
        </ScrollPane>
    </center>
    
    <bottom>
        <HBox alignment="CENTER_RIGHT" spacing="15" style="-fx-padding: 15 40;">
            <Button fx:id="backBtn" text="â¬… Quay láº¡i" styleClass="btn, btn-secondary" onAction="#onBack" visible="false"/>
            <Button fx:id="nextBtn" text="Tiáº¿p tá»¥c âž¡" styleClass="btn, btn-primary" onAction="#onNext"/>
        </HBox>
    </bottom>
    
</BorderPane>
